let url,mapsKey,editing=!1;$(document).ready(function(){console.log(sessionStorage),sessionStorage.username&&(console.log("you are logged in"),$("#registerModalBtn").addClass("d-none"),$("#loginModalBtn").addClass("d-none"),$("#logoutBtn").removeClass("d-none"),$("#addAListing").removeClass("d-none"))}),$.ajax({url:"config.json",type:"GET",dataType:"json",error:e=>{console.log("There was an issue getting the config file"),console.log(e)},success:e=>{url=`${e.SERVER_URL}:${e.SERVER_PORT}`,mapsKey=e.GOOGLE_MAPS_KEY,getListingsData()}}),$("#registerForm").click(()=>{event.preventDefault();let e=!0;const s=$("#registerName").val(),i=$("#registerAddress").val(),l=$("#registerUsername").val(),n=$("#registerPassword").val(),a=$("#registerConfirmPassword").val(),t=$("#registerEmail").val(),r=$("#registerDOB").val();0===s.length?($("#registerName").addClass("is-invalid"),$("#registerName").parent().children().last().show(),e=!1):($("#registerName").removeClass("is-invalid"),$("#registerName").parent().children().last().hide()),0===i.length?($("#registerAddress").addClass("is-invalid"),$("#registerAddress").parent().children().last().show(),e=!1):($("#registerAddress").removeClass("is-invalid"),$("#registerAddress").parent().children().last().hide()),0===l.length?($("#registerUsername").addClass("is-invalid"),$("#registerUsername").parent().children().last().show(),e=!1):($("#registerUsername").removeClass("is-invalid"),$("#registerUsername").parent().children().last().hide()),n!==a||0===n.length||0===a.length?($("#registerPassword").addClass("is-invalid"),$("#registerPassword").parent().children().last().show(),$("#registerConfirmPassword").addClass("is-invalid"),$("#registerConfirmPassword").parent().children().last().show(),e=!1):($("#registerPassword").removeClass("is-invalid"),$("#registerPassword").parent().children().last().hide(),$("#registerConfirmPassword").removeClass("is-invalid"),$("#registerConfirmPassword").parent().children().last().hide()),0===t.length?($("#registerEmail").addClass("is-invalid"),$("#registerEmail").parent().children().last().show(),e=!1):($("#registerEmail").removeClass("is-invalid"),$("#registerEmail").parent().children().last().hide()),0===r.length?($("#registerDOB").addClass("is-invalid"),$("#registerDOB").parent().children().last().show(),e=!1):($("#registerDOB").removeClass("is-invalid"),$("#registerDOB").parent().children().last().hide()),e&&$.ajax({url:`${url}/registerUser`,type:"POST",data:{name:s,address:i,username:l,password:n,email:t,dob:r,registerDate:Date.now()},success:e=>{console.log(e),sessionStorage.userId=e._id,sessionStorage.username=e.username,sessionStorage.name=e.name,sessionStorage.email=e.email,sessionStorage.address=e.address,$("#registerName").val(null),$("#registerAddress").val(null),$("#registerUsername").val(null),$("#registerPassword").val(null),$("#registerConfirmPassword").val(null),$("#registerEmail").val(null),$("#registerDOB").val(null)},error:e=>{console.log(e),console.log("something went wrong")}})});const getListingsData=()=>{$.ajax({url:`${url}/allListings`,type:"GET",dataType:"json",success:e=>{console.log(e),$("#listingList").empty(),e.map(e=>{let s=`<li class="list-group-item d-flex justify-content-between align-items-center listingItem" data-listingId="${e._id}">\n                <span class="listingName">${e.title}</span>`;s+='<div>\n                    <button class="btn btn-info editBtn">Edit</button>\n                    <button class="btn btn-danger removeBtn">Remove</button>\n                    </div>',s+="</li>",$("#listingList").append(s)})}})};$("#listingForm").click(()=>{if(event.preventDefault(),sessionStorage.length>0&&sessionStorage.id){let e=!0;const s=$("#listingTitle").val(),i=$("#listingDescription").val(),l=$("#listingPrice").val(),n=$("#listingImageFile").val();if(0===s.length?($("#listingTitle").addClass("is-invalid"),$("#listingTitle").parent().children().last().show(),e=!1):($("#listingTitle").removeClass("is-invalid"),$("#listingTitle").parent().children().last().hide()),0===i.length?($("#listingDescription").addClass("is-invalid"),$("#listingDescription").parent().children().last().show(),e=!1):($("#listingDescription").removeClass("is-invalid"),$("#listingDescription").parent().children().last().hide()),0===l.length?($("#listingPrice").addClass("is-invalid"),$("#listingPrice").parent().children().last().show(),e=!1):($("#listingPrice").removeClass("is-invalid"),$("#listingPrice").parent().children().last().hide()),0===n.length?($("#listingImageFile").addClass("is-invalid"),$("#listingImageFile").parent().children().last().show(),e=!1):($("#listingImageFile").removeClass("is-invalid"),$("#listingImageFile").parent().children().last().hide()),e){let e=new FormData;const n=$("#listingImageFile")[0].files[0];e.append("filePath",n),e.append("originalName",n.name),e.append("title",s),e.append("description",i),e.append("price",l),e.append("userId",sessionStorage.id),$.ajax({url:`${url}/newListing`,method:"POST",data:e,contentType:!1,processData:!1,success:e=>{console.log("successful"),$("#listingTitle").val(null),$("#listingDescription").val(null),$("#listingPrice").val(null),$("#listingImageFile").val(null),$("#toastListing").toast("show"),$("#listingModal").modal("hide")},error:e=>{console.log(e),console.log("did not work")}})}}else console.log("You are not logged in")}),$("#loginForm").submit(()=>{event.preventDefault();let e=!0,s=$("#loginUsername").val(),i=$("#loginPassword").val();0===s.length?($("#loginUsername").addClass("is-invalid"),$("#loginUsername").parent().children().last().show(),e=!1):($("#loginUsername").removeClass("is-invalid"),$("#loginUsername").parent().children().last().hide()),0===i.length?($("#loginPassword").addClass("is-invalid"),$("#loginPassword").parent().children().last().show(),e=!1):($("#loginPassword").removeClass("is-invalid"),$("#loginPassword").parent().children().last().hide()),e?$.ajax({url:`${url}/login`,type:"POST",data:{username:s,password:i},error:e=>{console.log("Error logging in"),console.log(e)},success:e=>{console.log(e),sessionStorage.userId=e._id,sessionStorage.username=e.username,sessionStorage.name=e.name,sessionStorage.email=e.email,sessionStorage.address=e.address,$("#loginModal").modal("hide"),$("#registerModalBtn").addClass("d-none"),$("#loginModalBtn").addClass("d-none"),$("#logoutBtn").removeClass("d-none"),$("#addAListing").removeClass("d-none")}}):console.log("You have not filled in all the login inputs")}),$("#logoutBtn").click(()=>{sessionStorage.clear(),$("#logoutBtn").addClass("d-none"),$("#addAListing").addClass("d-none"),$("#registerModalBtn").removeClass("d-none"),$("#loginModalBtn").removeClass("d-none")}),$("#addComment").click(()=>{if(event.preventDefault(),sessionStorage.length>0&&sessionStorage.id){let e=!0,s=$("#userComment").val();0===s.length?($("#userComment").addClass("is-invalid"),$("#userComment").parent().children().last().show(),e=!1):($("#userComment").removeClass("is-invalid"),$("#userComment").parent().children().last().hide()),e?$.ajax({url:`${url}/addAComment`,type:"POST",data:{commentUsername:sessionStorage.username,commentText:s,commentDate:Date.now(),commentReply:{reply:!1,replyId:null},commentUserId:sessionStorage.id,listingId:$("#listingDiv").attr("data-listingId")},success:e=>{console.log("comment posted")},error:e=>{console.log(e),console.log("did not post comment")}}):console.log("Invalid text")}else console.log("You are not logged in")});