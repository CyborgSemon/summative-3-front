let url,mapsKey,editing=!1;$(document).ready(function(){console.log(sessionStorage),sessionStorage.username&&(console.log("you are logged in"),$("#registerModalBtn").addClass("d-none"),$("#loginModalBtn").addClass("d-none"),$("#logoutBtn").removeClass("d-none"),$("#addAListing").removeClass("d-none"))}),$.ajax({url:"config.json",type:"GET",dataType:"json",error:t=>{console.log("There was an issue getting the config file"),console.log(t)},success:t=>{url=`${t.SERVER_URL}:${t.SERVER_PORT}`,mapsKey=t.GOOGLE_MAPS_KEY,getHome()}}),$("#registerForm").click(()=>{event.preventDefault();let t=!0;const e=$("#registerName").val(),s=$("#registerAddress").val(),i=$("#registerUsername").val(),l=$("#registerPassword").val(),n=$("#registerConfirmPassword").val(),a=$("#registerEmail").val(),r=$("#registerDOB").val();0===e.length?($("#registerName").addClass("is-invalid"),$("#registerName").parent().children().last().show(),t=!1):($("#registerName").removeClass("is-invalid"),$("#registerName").parent().children().last().hide()),0===s.length?($("#registerAddress").addClass("is-invalid"),$("#registerAddress").parent().children().last().show(),t=!1):($("#registerAddress").removeClass("is-invalid"),$("#registerAddress").parent().children().last().hide()),0===i.length?($("#registerUsername").addClass("is-invalid"),$("#registerUsername").parent().children().last().show(),t=!1):($("#registerUsername").removeClass("is-invalid"),$("#registerUsername").parent().children().last().hide()),l!==n||0===l.length||0===n.length?($("#registerPassword").addClass("is-invalid"),$("#registerPassword").parent().children().last().show(),$("#registerConfirmPassword").addClass("is-invalid"),$("#registerConfirmPassword").parent().children().last().show(),t=!1):($("#registerPassword").removeClass("is-invalid"),$("#registerPassword").parent().children().last().hide(),$("#registerConfirmPassword").removeClass("is-invalid"),$("#registerConfirmPassword").parent().children().last().hide()),0===a.length?($("#registerEmail").addClass("is-invalid"),$("#registerEmail").parent().children().last().show(),t=!1):($("#registerEmail").removeClass("is-invalid"),$("#registerEmail").parent().children().last().hide()),0===r.length?($("#registerDOB").addClass("is-invalid"),$("#registerDOB").parent().children().last().show(),t=!1):($("#registerDOB").removeClass("is-invalid"),$("#registerDOB").parent().children().last().hide()),t&&$.ajax({url:`${url}/registerUser`,type:"POST",data:{name:e,address:s,username:i,password:l,email:a,dob:r,registerDate:Date.now()},success:t=>{console.log(t),sessionStorage.userId=t._id,sessionStorage.username=t.username,sessionStorage.name=t.name,sessionStorage.email=t.email,sessionStorage.address=t.address,$("#registerName").val(null),$("#registerAddress").val(null),$("#registerUsername").val(null),$("#registerPassword").val(null),$("#registerConfirmPassword").val(null),$("#registerEmail").val(null),$("#registerDOB").val(null)},error:t=>{console.log(t),console.log("something went wrong")}})});const getListingsData=()=>{$.ajax({url:`${url}/allListings`,type:"GET",dataType:"json",success:t=>{console.log(t),$("#listingList").empty(),t.map(t=>{let e='<div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3 mt-3 text-center"';e+='<div class="card h-100 border-dark" >',e+='<div class="card-body">',e+='<img src="" class="card-img-top" alt="">',e+=`<h5 class="card-title">${t.title}</h5>`,e+='<div class="d-flex justify-content-between">',e+=`<span>$${t.price}</span>`,e+='<div class="btn btn-primary">Edit</div>',e+="</div>",$("#listingList").append(e),$("#listingPageList").append(e)})}})},getHome=()=>{$.ajax({url:`${url}/home`,type:"GET",dataType:"json",success:t=>{console.log(t),$("#featuredListing").html(`<div class="card mb-3" style="width: 70%;">\n\t\t\t\t\t\t\t\t\t\t\t<div class="row no-gutters">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-md-4" style="background-image: url('${url}/${t[0].filePath.replace(/\\/g,"/")}'); background-size: cover; background-position: center; background-repeat: no-repeat;">\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-md-8">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="card-body" style="max-height: 100%;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h5 class="card-title">${t[0].title}</h5>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="card-text">${t[0].description}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="card-text">$${t[0].price}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class="btn btn-secondary">Learn More</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>`),t.map((t,e)=>{})},error:t=>{console.log(t),console.log("could not get the home page listings")}})};$("#listingForm").click(()=>{if(event.preventDefault(),sessionStorage.length>0&&sessionStorage.userId){let t=!0;const e=$("#listingTitle").val(),s=$("#listingDescription").val(),i=$("#listingPrice").val(),l=$("#listingImageFile").val();if(0===e.length?($("#listingTitle").addClass("is-invalid"),$("#listingTitle").parent().children().last().show(),t=!1):($("#listingTitle").removeClass("is-invalid"),$("#listingTitle").parent().children().last().hide()),0===s.length?($("#listingDescription").addClass("is-invalid"),$("#listingDescription").parent().children().last().show(),t=!1):($("#listingDescription").removeClass("is-invalid"),$("#listingDescription").parent().children().last().hide()),0===i.length?($("#listingPrice").addClass("is-invalid"),$("#listingPrice").parent().children().last().show(),t=!1):($("#listingPrice").removeClass("is-invalid"),$("#listingPrice").parent().children().last().hide()),0===l.length?($("#listingImageFile").addClass("is-invalid"),$("#listingImageFile").parent().children().last().show(),t=!1):($("#listingImageFile").removeClass("is-invalid"),$("#listingImageFile").parent().children().last().hide()),t){let t=new FormData;const l=$("#listingImageFile")[0].files[0];console.log(l),t.append("filePath",l),t.append("originalName",l.name),t.append("title",e),t.append("description",s),t.append("price",i),t.append("userId",sessionStorage.userId),$.ajax({url:`${url}/newListing`,method:"POST",data:t,contentType:!1,processData:!1,success:t=>{console.log("successful"),$("#listingTitle").val(null),$("#listingDescription").val(null),$("#listingPrice").val(null),$("#listingImageFile").val(null),$("#toastListing").toast("show"),$("#listingModal").modal("hide")},error:t=>{console.log(t),console.log("did not work")}})}}else console.log("You are not logged in")}),$("#loginForm").submit(()=>{event.preventDefault();let t=!0,e=$("#loginUsername").val(),s=$("#loginPassword").val();0===e.length?($("#loginUsername").addClass("is-invalid"),$("#loginUsername").parent().children().last().show(),t=!1):($("#loginUsername").removeClass("is-invalid"),$("#loginUsername").parent().children().last().hide()),0===s.length?($("#loginPassword").addClass("is-invalid"),$("#loginPassword").parent().children().last().show(),t=!1):($("#loginPassword").removeClass("is-invalid"),$("#loginPassword").parent().children().last().hide()),t?$.ajax({url:`${url}/login`,type:"POST",data:{username:e,password:s},error:t=>{console.log("Error logging in"),console.log(t)},success:t=>{console.log(t),sessionStorage.userId=t._id,sessionStorage.username=t.username,sessionStorage.name=t.name,sessionStorage.email=t.email,sessionStorage.address=t.address,$("#loginModal").modal("hide"),$("#registerModalBtn").addClass("d-none"),$("#loginModalBtn").addClass("d-none"),$("#logoutBtn").removeClass("d-none"),$("#addAListing").removeClass("d-none")}}):console.log("You have not filled in all the login inputs")}),$("#logoutBtn").click(()=>{sessionStorage.clear(),$("#logoutBtn").addClass("d-none"),$("#addAListing").addClass("d-none"),$("#registerModalBtn").removeClass("d-none"),$("#loginModalBtn").removeClass("d-none")}),$("#addComment").click(()=>{if(event.preventDefault(),sessionStorage.length>0&&sessionStorage.userId){let t=!0,e=$("#userComment").val();0===e.length?($("#userComment").addClass("is-invalid"),$("#userComment").parent().children().last().show(),t=!1):($("#userComment").removeClass("is-invalid"),$("#userComment").parent().children().last().hide()),t?$.ajax({url:`${url}/addAComment`,type:"POST",data:{commentUsername:sessionStorage.username,commentText:e,commentDate:Date.now(),commentReply:{reply:!1,replyId:null},commentUserId:sessionStorage.userId,listingId:$("#listingDiv").attr("data-listingId")},success:t=>{console.log("comment posted")},error:t=>{console.log(t),console.log("did not post comment")}}):console.log("Invalid text")}else console.log("You are not logged in")});