let url,mapsKey,editing=!1;$(document).ready(function(){console.log(sessionStorage)}),$.ajax({url:"config.json",type:"GET",dataType:"json",error:e=>{console.log("There was an issue getting the config file"),console.log(e)},success:e=>{url=`${e.SERVER_URL}:${e.SERVER_PORT}`,mapsKey=e.GOOGLE_MAPS_KEY,getListingsData()}}),$("#registerForm").click(()=>{event.preventDefault();let e=!0;const s=$("#registerName").val(),t=$("#registerAddress").val(),n=$("#registerUsername").val(),o=$("#registerPassword").val(),i=$("#registerConfirmPassword").val(),l=$("#registerEmail").val(),a=$("#registerDOB").val();0===s.length&&($("#registerName").addClass("is-invalid"),e=!1),0===t.length&&($("#registerAddress").addClass("is-invalid"),e=!1),0===n.length&&($("#registerUsername").addClass("is-invalid"),e=!1),0===o.length&&($("#registerPassword").addClass("is-invalid"),e=!1),0===i.length&&($("#registerConfirmPassword").addClass("is-invalid"),e=!1),o!==i?($("#registerConfirmPassword").addClass("is-invalid"),$("#registerConfirmPassword").parent().append('<div class="invalid-feedback">Passwords do not match</div>'),e=!1):$("#registerConfirmPassword").parent().children().last().remove(),0===l.length&&($("#registerEmail").addClass("is-invalid"),e=!1),0===a.length&&($("#registerDOB").addClass("is-invalid"),e=!1),e&&$.ajax({url:`${url}/registerUser`,type:"POST",data:{name:s,address:t,username:n,password:o,email:l,dob:a,registerDate:Date.now()},success:e=>{console.log(e),sessionStorage.userId=e._id,sessionStorage.username=e.username,sessionStorage.name=e.name,sessionStorage.email=e.email,sessionStorage.address=e.address},error:e=>{console.log(e),console.log("something went wrong")}})}),getListingsData=(()=>{$.ajax({url:`${url}/allListings`,type:"GET",dataType:"json",success:e=>{console.log(e),$("#listingList").empty(),e.map(e=>{let s=`<li class="list-group-item d-flex justify-content-between align-items-center listingItem" data-listingId="${e._id}">\n                <span class="listingName">${e.title}</span>`;s+='<div>\n                    <button class="btn btn-info editBtn">Edit</button>\n                    <button class="btn btn-danger removeBtn">Remove</button>\n                    </div>',s+="</li>",$("#listingList").append(s)})}})}),$("#listingForm").click(()=>{event.preventDefault();const e=$("#listingTitle").val(),s=$("#listingDescription").val(),t=$("#listingPrice").val();if(0===e.length)console.log("listing title needs an input");else if(0===s.length)console.log("listing description needs an input");else if(0===t.length)console.log("listing price needs an input");else{let n=new FormData;const o=$("#listingImageFile")[0].files[0];if(n.append("filePath",o),n.append("originalName",o.name),n.append("title",e),n.append("description",s),n.append("price",t),console.log(n),!0===editing){const e=$("#productID").val();$.ajax({url:`${url}/product/${e}`,type:"PATCH",data:{name:productName,price:productPrice,userId:sessionStorage.userId},success:function(s){console.log(s),$("#listingTitle").val(null),$("#listingDescription").val(null),$("#listingPrice").val(null),$("#addProductButton").text("Add Listing").addClass("btn-warning"),$("#heading").text("Add Product"),editing=!1,$(".productItem").each(function(){$(this).data("id")===e&&$(this).find(".productName").text(productName)})},error:function(e){console.log(e),console.log("something went wront with editing the product")}})}else $.ajax({url:`${url}/newListing`,method:"POST",data:n,contentType:!1,processData:!1,success:e=>{console.log("successful")},error:e=>{console.log(e),console.log("did not work")}})}}),$("#loginForm").submit(()=>{event.preventDefault();let e=$("#loginUsername").val(),s=$("#loginPassword").val();0!==e.length&&0!==s.length?$.ajax({url:`${url}/login`,type:"POST",data:{username:e,password:s},error:e=>{console.log("Error logging in"),console.log(e)},success:e=>{console.log(e),sessionStorage.userId=e._id,sessionStorage.username=e.username,sessionStorage.name=e.name,sessionStorage.email=e.email,sessionStorage.address=e.address}}):console.log("You have not filled in all the login inputs")}),$("#logoutBtn").click(()=>{sessionStorage.clear()}),$("#addComment").click(()=>{event.preventDefault();let e=$("#userComment").val();0===e.length?console.log("please enter a comment"):0!==sessionStorage.length?$.ajax({url:`${url}/addAComment`,type:"POST",data:{commentUsername:sessionStorage.username,commentText:e,commentDate:Date.now()},success:e=>{console.log("comment posted")},error:e=>{console.log(e),console.log("did not post comment")}}):console.log("cannot post comment")}),$("#listingList").on("click",".editBtn",()=>{event.preventDefault(),sessionStorage.userId?$.ajax({url:`${url}/listing/${id}`,type:"post",data:{userId:sessionStorage.userId},dataType:"json",success:e=>{console.log(e),$("#listingTitle").val(e.title),$("#listingDescription").val(e.description),$("#listingPrice").val(e.price),$("#addProductButton").text("Edit Listing").addClass("btn-warning"),$("#heading").text("Edit Product"),editing=!0},error:e=>{console.log(e),console.log("something went wrong with getting the single product")}}):alert("401, permission denied")}),$("#productList").on("click",".removeBtn",()=>{event.preventDefault(),sessionStorage.userId?$.ajax({url:`${url}/listing/${id}`,type:"DELETE",success:e=>{li.remove()},error:function(e){console.log(e),console.log("something went wrong deleting the product")}}):alert("401, permission denied")}),$("#commentList").on("click",".editBtn",()=>{event.preventDefault(),sessionStorage.userId?$.ajax({url:`${url}/getComment`,type:"post",data:{userId:sessionStorage.userId},dataType:"json",success:e=>{console.log(e),$("#commentText").val(e.text),$("#addProductButton").text("Edit Listing").addClass("btn-warning"),$("#heading").text("Edit Product"),editing=!0},error:e=>{console.log(e),console.log("something went wrong with getting the single product")}}):alert("401, permission denied")});