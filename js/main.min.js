let url,mapsKey;$(document).ready(function(){console.log(sessionStorage),sessionStorage.username&&(console.log("you are logged in"),$("#loginModalBtn").hide(),$("#registerModalBtn").hide(),$("#logoutBtn").removeClass("d-none"))}),$.ajax({url:"config.json",type:"GET",dataType:"json",error:e=>{console.log("There was an issue getting the config file"),console.log(e)},success:e=>{url=`${e.SERVER_URL}:${e.SERVER_PORT}`,mapsKey=e.GOOGLE_MAPS_KEY}}),$("#registerForm").click(()=>{event.preventDefault();let e=!0;const s=$("#registerName").val(),n=$("#registerAddress").val(),o=$("#registerUsername").val(),l=$("#registerPassword").val(),t=$("#registerConfirmPassword").val(),i=$("#registerEmail").val(),r=$("#registerDOB").val();0===s.length&&($("#registerName").addClass("is-invalid"),e=!1),0===n.length&&($("#registerAddress").addClass("is-invalid"),e=!1),0===o.length&&($("#registerUsername").addClass("is-invalid"),e=!1),0===l.length&&($("#registerPassword").addClass("is-invalid"),e=!1),0===t.length&&($("#registerConfirmPassword").addClass("is-invalid"),e=!1),l!==t?($("#registerConfirmPassword").addClass("is-invalid"),$("#registerConfirmPassword").parent().append('<div class="invalid-feedback">Passwords do not match</div>'),e=!1):$("#registerConfirmPassword").parent().children().last().remove(),0===i.length&&($("#registerEmail").addClass("is-invalid"),e=!1),0===r.length&&($("#registerDOB").addClass("is-invalid"),e=!1),e&&$.ajax({url:`${url}/registerUser`,type:"POST",data:{name:s,address:n,username:o,password:l,email:i,dob:r,registerDate:Date.now()},success:e=>{console.log(e),sessionStorage.userId=e._id,sessionStorage.username=e.username,sessionStorage.name=e.name,sessionStorage.email=e.email,sessionStorage.address=e.address,$("#registerName").val(null),$("#registerAddress").val(null),$("#registerUsername").val(null),$("#registerPassword").val(null),$("#registerConfirmPassword").val(null),$("#registerEmail").val(null),$("#registerDOB").val(null)},error:e=>{console.log(e),console.log("something went wrong")}})}),$("#listingForm").click(()=>{event.preventDefault();const e=$("#listingTitle").val(),s=$("#listingDescription").val(),n=$("#listingPrice").val();if(0===e.length)console.log("listing title needs an input");else if(0===s.length)console.log("listing description needs an input");else if(0===n.length)console.log("listing price needs an input");else{let o=new FormData;const l=$("#listingImageFile")[0].files[0];o.append("filePath",l),o.append("originalName",l.name),o.append("title",e),o.append("description",s),o.append("price",n),console.log(o),$.ajax({url:`${url}/newListing`,method:"POST",data:o,contentType:!1,processData:!1,success:e=>{console.log("successful"),$("#listingTitle").val(null),$("#listingDescription").val(null),$("#listingPrice").val(null)},error:e=>{console.log(e),console.log("did not work")}})}}),$("#loginForm").submit(()=>{event.preventDefault();let e=$("#loginUsername").val(),s=$("#loginPassword").val();0!==e.length&&0!==s.length?$.ajax({url:`${url}/login`,type:"POST",data:{username:e,password:s},error:e=>{console.log("Error logging in"),console.log(e)},success:e=>{console.log(e),sessionStorage.userId=e._id,sessionStorage.username=e.username,sessionStorage.name=e.name,sessionStorage.email=e.email,sessionStorage.address=e.address,$("#loginModal").modal("hide"),$("#registerModalBtn").addClass("d-none"),$("#loginModalBtn").addClass("d-none"),$("#logoutBtn").removeClass("d-none")}}):console.log("You have not filled in all the login inputs")}),$("#logoutBtn").click(()=>{sessionStorage.clear(),$("#logoutBtn").addClass("d-none"),$("#registerModalBtn").removeClass("d-none"),$("#loginModalBtn").removeClass("d-none")}),$("#addComment").click(()=>{event.preventDefault();let e=$("#userComment").val();0===e.length?console.log("please enter a comment"):0!==sessionStorage.length?$.ajax({url:`${url}/addAComment`,type:"POST",data:{commentUsername:sessionStorage.username,commentText:e,commentDate:Date.now()},success:e=>{console.log("comment posted")},error:e=>{console.log(e),console.log("did not post comment")}}):console.log("cannot post comment")}),$("#listingList").on("click",".editBtn",()=>{event.preventDefault(),sessionStorage.userId?$.ajax({url:`${url}/listing/${id}`,type:"post",data:{userId:sessionStorage.userId},dataType:"json",success:e=>{console.log(e),$("#listingTitle").val(e.title),$("#listingDescription").val(e.description),$("#listingPrice").val(e.price),$("#addProductButton").text("Edit Listing").addClass("btn-warning"),$("#heading").text("Edit Product"),editing=!0},error:e=>{console.log(e),console.log("something went wrong with getting the single product")}}):alert("401, permission denied")}),$("#productList").on("click",".removeBtn",()=>{event.preventDefault(),sessionStorage.userId?$.ajax({url:`${url}/listing/${id}`,type:"DELETE",success:e=>{li.remove()},error:function(e){console.log(e),console.log("something went wrong deleting the product")}}):alert("401, permission denied")});